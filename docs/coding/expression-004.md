第四章 表达式和基本语句
=====
<br>

4.1 运算符的优先级
----

    PHP的运算符有数十个，运算符的优先级与结合律如表4-1所示。注意一元运算符 +  -  * 的优先级高于对应的二元运算符。

![表4-1 运算符的优先级与结合律](https://github.com/tinycn/tinyphp/blob/master/docs/image/4.1.png)


`【规则4-1-1】`如果代码行中的运算符比较多，用括号确定表达式的操作顺序，避免使用默认的优先级。

  由于将表4-1熟记是比较困难的，为了防止产生歧义并提高可读性，应当用括号确定表达式的操作顺序。例如：
```php
$word = ($high + 8) * $low
if (($a == $b) && ($a != $c))
```

4.2 复合表达式
----
    如 $a = $b = $c = 0这样的表达式称为复合表达式。允许复合表达式存在的理由是：（1）书写简洁；（2）可以提高编译效率。但要防止滥用复合表达式。

`【规则4-2-1】`不要编写太复杂的复合表达式。
例如：
```php
$i = $a >=$b && $c < $d&& $c + $f <= $g + $h ; // 复合表达式过于复杂
```

`【规则4-2-2】`不要有多用途的复合表达式。
例如：
```php
$d = ($a = $b + $c) + $r ; 
```

该表达式既求a值又求d值。应该拆分为两个独立的语句：
```php
$a = $b + $c;
$d = $a + $r;
```
 
`【规则4-2-3】`不要把程序中的复合表达式与“真正的数学表达式”混淆。
例如：  
```php
if ($a < $b < $c)           // a < b < c是数学表达式而不是程序表达式
```
并不表示       
```php
if (($a < $b) && $(b < $c))
```
而是成了令人费解的
```php
if ( ($a < $b) < $c )
```


4.3 if 语句    
------

        if语句是PHP语言中最简单、最常用的语句，然而很多程序员用隐含错误的方式写if语句。本节以“与零值比较”为例，展开讨论。

 
4.3.1 布尔变量与零值比较
-------
`【规则4-3-1】`不可将布尔变量直接与`TRUE、FALSE`或者`1、0`进行比较。
    假设布尔变量名字为$flag`，它与零值比较的标准if语句如下：
```php
if ($flag)   //表示$flag为真
if (!$flag)  //表示$flag为假
```

其它的用法都属于不良风格，例如：
```php
    if ($flag == TRUE)  

    if ($flag == 1 )        

    if ($flag == FALSE)  

    if ($flag == 0)     
```
 

4.3.2 整型变量与零值比较
----

`【规则4-3-2】`应当将整型变量用“==”或“!=”直接与0比较。
    假设整型变量的名字为`$value`，它与零值比较的标准if语句如下：
```php
if ($value == 0)  
if ($value != 0)
```

不可模仿布尔变量的风格而写成
```php
if ($value)    //会让人误解 $value是布尔变量

if (!$value) 
```
 <br>
<br>

4.3.3 浮点变量与零值比较
-----

`【规则4-3-3】`不可将浮点变量用“==”或“！=”与任何数字比较。
    千万要留意，无论是float还是double类型的变量，都有精度限制。所以一定要避免将浮点变量用“==”或“！=”与数字比较，应该设法转化成“>=”或“<=”形式。
    假设浮点变量的名字为x，应当将   
```php
if ($x == 0.0) // 隐含错误的比较
```

转化为 
```php
if (($x >= -EPSINON) && (x <= EPSINON))
```

其中EPSINON是允许的误差（即精度）。
<br>
<br>

4.3.4 对if语句的补充说明
----

有时候我们可能会看到 if (NULL == p) 这样古怪的格式。不是程序写错了，是程序员为了防止将 if (p == NULL) 误写成 if (p = NULL)，而有意把p和NULL颠倒。编译器认为 if (p = NULL) 是合法的，但是会指出 if (NULL = p)是错误的，因为NULL不能被赋值。

程序中有时会遇到if/else/return的组合，应该将如下不良风格的程序
```php    

if ($condition) 
    return $x;
return $y;

```
改写为

```php

if ($condition)
{
    return $x;
}
else
{
    return $y;

}
```
或者改写成更加简练的 
```php
return ($condition ? $x : $y);
```

<br>
<br>

4.4 循环语句的效率
----
    PHP循环语句中，for/foreach语句使用频率最高，while语句其次，do语句很少用。本节重点论述循环体的效率。提高循环体效率的基本办法是降低循环体的复杂性。

`【建议4-4-1】`在多重循环中，如果有可能，应当将最长的循环放在最内层，最短的循环放在最外层，以减少CPU跨切循环层的次数。例如示例4-4(b)的效率比示例4-4(a)的高。
```php

for ($row = 0; $row < 100; $row++)
{
    for ($col = 0; $col < 5; $col++)
    {
        sum = $sum + $a[$row][$col];
    }
}

```

示例4-4(a) 低效率：长循环在最外层

```php
 for ($col = 0; $col < 5; $col++ )
{
    for ($row = 0;$ row < 100; $row++)
    {
        $sum = $sum + $a[$row][$col];
    }
}
```
示例4-4(b) 高效率：长循环在最内层


`【建议4-4-2】`如果循环体内存在逻辑判断，并且循环次数很大，宜将逻辑判断移到循环体的外面。示例4-4(c)的程序比示例4-4(d)多执行了N-1次逻辑判断。并且由于前者老要进行逻辑判断，打断了循环“流水线”作业，使得编译器不能对循环进行优化处理，降低了效率。如果N非常大，最好采用示例4-4(d)的写法，可以提高效率。如果N非常小，两者效率差别并不明显，采用示例4-4(c)的写法比较好，因为程序更加简洁。

```php
for ($i = 0; $i < N; $i++)
{
    if ($condition)
        doSomething();
    else
        doOtherthing();
}
```
表4-4(c) 效率低但程序简洁

```php
if ($condition)
{
    for ($i = 0; $i < N; $i++)
        doSomething();
}
else
{
    for ($i = 0; $i < N; $i++)
        doOtherthing();
}
 ```
表4-4(d) 效率高但程序不简洁

<br>
<br>

4.5 for 语句的循环控制变量
----

`【规则4-5-1】`不可在for 循环体内修改循环变量，防止for 循环失去控制。
`【建议4-5-1】`建议for语句的循环控制变量的取值采用“半开半闭区间”写法。

示例4-5(a)中的x值属于半开半闭区间“0 =< $x < $N”，起点到终点的间隔为N，循环次数为N。

示例4-5(b)中的x值属于闭区间“0 =< $x <= N-1”，起点到终点的间隔为N-1，循环次数为N。

相比之下，示例4-5(a)的写法更加直观，尽管两者的功能是相同的。

```php
for ($x = 0; $x < N; $x++)
{
    …
}
```
示例4-5(a) 循环变量属于半开半闭区间

```php
for ($x = 0; $x <= N-1; $x++)
{
    …
}
``` 
示例4-5(b) 循环变量属于闭区间

<br>
<br>

4.6 switch语句
----

有了if语句为什么还要`switch`语句？
`switch`是多分支选择语句，而if语句只有两个分支可供选择。虽然可以用嵌套的if语句来实现多分支选择，但那样的程序冗长难读。这是`switch`语句存在的理由。
`switch`语句的基本格式是：

```php
switch ($variable)
{
    case $value1 : … 
    break;

case $value2 :… 
    break;
    …
    default :  … 
    break;
}
```
 

`【规则4-6-1】`每个case语句的结尾不要忘了加`break`，否则将导致多个分支重叠（除非有意使多个分支重叠）。

`【规则4-6-2】`不要忘记最后那个`default`分支。即使程序真的不需要`default`处理，也应该保留语句   “`default : break`;” 这样做并非多此一举，而是为了防止别人误以为你忘了`default`处理。

如果某个`case`分支语句过长，在`break`右侧应加上注释  /*jump into next*/

<br>
<br>

4.7 goto语句
----
虽然`PHP`有`goto`语句， 本规范禁用。
